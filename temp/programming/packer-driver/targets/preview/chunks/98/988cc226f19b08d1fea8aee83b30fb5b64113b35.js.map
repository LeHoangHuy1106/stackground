{"version":3,"sources":["file:///D:/PROJECT/stackground/assets/Scripts/Extention/Joystick.ts"],"names":["_decorator","Component","EventHandler","Node","UITransform","Vec2","Vec3","ccclass","property","Joystick","type","size","onLoad","node","on","EventType","TOUCH_START","onTouchStart","TOUCH_MOVE","onTouchMove","TOUCH_END","onTouchEnd","TOUCH_CANCEL","onTouchCancel","getComponent","contentSize","width","event","onBegin","getLocation","onEnd","screenPosition","position","inverseTransformPoint","x","y","length","arrowsNode","setPosition","axis","emitEvents","axisEvents","ZERO"],"mappings":";;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAqBC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,Y,OAAAA,Y;AAA0BC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,I,OAAAA,I;;;;;;;;;OACtF;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBR,U;;0BAGjBS,Q,WADZF,OAAO,CAAC,UAAD,C,UAGNC,QAAQ,CAAC;AAAEE,QAAAA,IAAI,EAAEP;AAAR,OAAD,C,UAGRK,QAAQ,CAAC;AAAEE,QAAAA,IAAI,EAAE,CAACR,YAAD;AAAR,OAAD,C,2BANV,MACaO,QADb,SAC8BR,SAD9B,CACwC;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAQ/BU,IAR+B;AAAA;;AAU7BC,QAAAA,MAAM,GAAS;AACxB,eAAKC,IAAL,CAAUC,EAAV,CAAaX,IAAI,CAACY,SAAL,CAAeC,WAA5B,EAAyC,KAAKC,YAA9C,EAA4D,IAA5D;AACA,eAAKJ,IAAL,CAAUC,EAAV,CAAaX,IAAI,CAACY,SAAL,CAAeG,UAA5B,EAAwC,KAAKC,WAA7C,EAA0D,IAA1D;AACA,eAAKN,IAAL,CAAUC,EAAV,CAAaX,IAAI,CAACY,SAAL,CAAeK,SAA5B,EAAuC,KAAKC,UAA5C,EAAwD,IAAxD;AACA,eAAKR,IAAL,CAAUC,EAAV,CAAaX,IAAI,CAACY,SAAL,CAAeO,YAA5B,EAA0C,KAAKC,aAA/C,EAA8D,IAA9D;AAEA,eAAKZ,IAAL,GAAY,KAAKa,YAAL,CAAkBpB,WAAlB,EAA+BqB,WAA/B,CAA2CC,KAA3C,GAAmD,GAA/D;AACA;;AAEOT,QAAAA,YAAY,CAACU,KAAD,EAA0B;AAC7C,eAAKC,OAAL,CAAaD,KAAK,CAACE,WAAN,EAAb;AACA;;AAEOV,QAAAA,WAAW,CAACQ,KAAD,EAA0B;AAC5C,eAAKC,OAAL,CAAaD,KAAK,CAACE,WAAN,EAAb;AACA;;AAEOR,QAAAA,UAAU,CAACM,KAAD,EAA0B;AAC3C,eAAKG,KAAL;AACA;;AAEOP,QAAAA,aAAa,CAACI,KAAD,EAA0B;AAC9C,eAAKG,KAAL;AACA;;AAEOF,QAAAA,OAAO,CAACG,cAAD,EAA6B;AAC3C,cAAIC,QAAQ,GAAG,IAAI1B,IAAJ,EAAf;AACA0B,UAAAA,QAAQ,GAAG,KAAKnB,IAAL,CAAUoB,qBAAV,CAAgCD,QAAhC,EAA0C,IAAI1B,IAAJ,CAASyB,cAAc,CAACG,CAAxB,EAA2BH,cAAc,CAACI,CAA1C,EAA6C,GAA7C,CAA1C,CAAX;AACA,cAAMC,MAAM,GAAGJ,QAAQ,CAACI,MAAT,EAAf;;AACA,cAAIA,MAAM,GAAG,KAAKzB,IAAlB,EAAwB;AACvBqB,YAAAA,QAAQ,CAACE,CAAT,GAAaF,QAAQ,CAACE,CAAT,GAAa,KAAKvB,IAAlB,GAAyByB,MAAtC;AACAJ,YAAAA,QAAQ,CAACG,CAAT,GAAaH,QAAQ,CAACG,CAAT,GAAa,KAAKxB,IAAlB,GAAyByB,MAAtC;AACA;;AACD,eAAKC,UAAL,CAAgBC,WAAhB,CAA4BN,QAA5B;AAEA,cAAMO,IAAI,GAAG,IAAIlC,IAAJ,CAAS2B,QAAQ,CAACE,CAAT,GAAa,KAAKvB,IAA3B,EAAiCqB,QAAQ,CAACG,CAAT,GAAa,KAAKxB,IAAnD,CAAb;AACAT,UAAAA,YAAY,CAACsC,UAAb,CAAwB,KAAKC,UAA7B,EAAyC,IAAzC,EAA+CF,IAA/C;AACA;;AAEOT,QAAAA,KAAK,GAAS;AACrB,eAAKO,UAAL,CAAgBC,WAAhB,CAA4BhC,IAAI,CAACoC,IAAjC;AAEAxC,UAAAA,YAAY,CAACsC,UAAb,CAAwB,KAAKC,UAA7B,EAAyC,IAAzC,EAA+CpC,IAAI,CAACqC,IAApD;AACA;;AArDsC,O;;;;;iBAGZ,I;;;;;;;iBAGU,E","sourcesContent":["import { _decorator, CCFloat, Component, EventHandler, EventTouch, Node, UITransform, Vec2, Vec3 } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('Joystick')\r\nexport class Joystick extends Component {\r\n\r\n\t@property({ type: Node })\r\n\tprivate arrowsNode: Node = null;\r\n\r\n\t@property({ type: [EventHandler] })\r\n\tprivate axisEvents: EventHandler[] = [];\r\n\r\n\tprivate size: number;\r\n\r\n\tprotected onLoad(): void {\r\n\t\tthis.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n\t\tthis.node.on(Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n\t\tthis.node.on(Node.EventType.TOUCH_END, this.onTouchEnd, this);\r\n\t\tthis.node.on(Node.EventType.TOUCH_CANCEL, this.onTouchCancel, this);\r\n\r\n\t\tthis.size = this.getComponent(UITransform).contentSize.width / 2.0;\r\n\t}\r\n\r\n\tprivate onTouchStart(event: EventTouch): void {\r\n\t\tthis.onBegin(event.getLocation());\r\n\t}\r\n\r\n\tprivate onTouchMove(event: EventTouch): void {\r\n\t\tthis.onBegin(event.getLocation());\r\n\t}\r\n\r\n\tprivate onTouchEnd(event: EventTouch): void {\r\n\t\tthis.onEnd();\r\n\t}\r\n\r\n\tprivate onTouchCancel(event: EventTouch): void {\r\n\t\tthis.onEnd();\r\n\t}\r\n\r\n\tprivate onBegin(screenPosition: Vec2): void {\r\n\t\tlet position = new Vec3();\r\n\t\tposition = this.node.inverseTransformPoint(position, new Vec3(screenPosition.x, screenPosition.y, 0.0));\r\n\t\tconst length = position.length();\r\n\t\tif (length > this.size) {\r\n\t\t\tposition.x = position.x * this.size / length;\r\n\t\t\tposition.y = position.y * this.size / length;\r\n\t\t}\r\n\t\tthis.arrowsNode.setPosition(position);\r\n\r\n\t\tconst axis = new Vec2(position.x / this.size, position.y / this.size);\r\n\t\tEventHandler.emitEvents(this.axisEvents, this, axis);\r\n\t}\r\n\r\n\tprivate onEnd(): void {\r\n\t\tthis.arrowsNode.setPosition(Vec3.ZERO);\r\n\r\n\t\tEventHandler.emitEvents(this.axisEvents, this, Vec2.ZERO);\r\n\t}\r\n}\r\n"]}