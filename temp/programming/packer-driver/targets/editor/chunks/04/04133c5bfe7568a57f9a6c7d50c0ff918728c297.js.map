{"version":3,"sources":["file:///D:/PROJECT/stackground/assets/Scripts/Extention/ObjectPool.ts"],"names":["_decorator","Component","instantiate","director","NodeCustom","ccclass","property","ObjectPool","index","dictQueue","Instance","instance","onLoad","node","destroy","addPersistRootNode","CreateListObject","name","prefab","n","parent","queueObject","i","obj","objCustom","addComponent","setParent","GetNode","active","push","getObject","isQuantityLimit","count","length","shift","getComponent"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, instantiate, game, director } from 'cc';\r\nimport { NodeCustom } from './NodeCustom';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ObjectPool')\r\nexport class ObjectPool extends Component {\r\n    private static instance: ObjectPool = null;\r\n    private index = 0;\r\n    private dictQueue: { [key: string]: NodeCustom[] } = {};\r\n    \r\n    public static get Instance(): ObjectPool {\r\n        if (this.instance === null) {\r\n            this.instance = new ObjectPool;\r\n        }\r\n        return this.instance;\r\n    }\r\n\r\n    onLoad() {\r\n        if (ObjectPool.instance !== null && ObjectPool.instance !== this) {\r\n            this.node.destroy();\r\n            return;\r\n        } else {\r\n            ObjectPool.instance = this;\r\n        }\r\n\r\n        director.addPersistRootNode(this.node);\r\n    }\r\n    public CreateListObject(name: string, prefab: Prefab, n: number, parent: Node) {\r\n        const queueObject: NodeCustom[] = [];\r\n\r\n        for (let i = 0; i < n; i++) {\r\n            const obj = instantiate(prefab);\r\n            let objCustom = obj.addComponent(NodeCustom);\r\n            obj.setParent(parent);            \r\n            objCustom.GetNode().name = obj.name + \"_\" + this.index;\r\n            objCustom.GetNode().active = false;\r\n            this.index++;\r\n\r\n\r\n            queueObject.push(objCustom);\r\n        }\r\n        this.dictQueue[name] = queueObject;\r\n    }\r\n\r\n    public getObject(name: string, parent: Node = null, isQuantityLimit: Boolean = false): NodeCustom {\r\n        let objCustom: NodeCustom;\r\n        const count = this.dictQueue[name].length;\r\n        for (let i = 0; i < count; i++) {\r\n            objCustom = this.dictQueue[name].shift();\r\n            if (!objCustom.GetNode().active) {\r\n                this.dictQueue[name].push(objCustom);\r\n                return objCustom;\r\n            }\r\n            this.dictQueue[name].push(objCustom);\r\n        }\r\n        if (isQuantityLimit) {\r\n            return null;\r\n        }\r\n        let obj = instantiate(this.dictQueue[name][0].GetNode());\r\n        objCustom = obj.getComponent(NodeCustom);\r\n        if (parent != null) {\r\n            objCustom.GetNode().setParent(parent);\r\n        }\r\n        objCustom.GetNode().active = false;\r\n        this.dictQueue[name].push(objCustom);\r\n        return objCustom;\r\n    }\r\n}\r\n\r\n\r\n"]}